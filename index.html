{% include 'npage/base.html' %}
{% load i18n %}


{% block head %}

<title>talk</title>

{% endblock %}

{% block content %}
<br>    
<div class="row white">
    <div class="columns large-12">
        
        <form onsubmit='return false;'>
            {% csrf_token %}
            <input type="text" id="the_post" class='round'></input>
            <input type='submit' onclick='create_post()' class="button small round success right">

            <!-- <div class="ajaxProgress" style='display:none;'>
                <i class="fa fa-circle-o-notch fa-2x fa-spin"></i>
            </div> -->
        </form>
        
        <hr>
        
        <div id="talk">
           <!--Should show up here-->
            {% for p in all_posts %}   
                <div class="panel radius"> 
                    <p>
                        {{p.text}} 
                    </p>
                    <p class='right'>
                        <em style='font-size:.7em;'>{{ p.author }} on {{p.created}}</em><br>
                        <a href="#" id="comment" class='right'>Comment</a>
                    </p>
                    <br><br>
                </div>
            {% endfor %}
        </div>
        

    </div>
</div>



<script type="text/javascript">
        
    function create_post(){
        console.log('clicky clicky');
        $('.ajaxProgress').show(); // Show that the post is being posted
        $.post( "create_post", { name: "John", time: "2pm" } );

        $.ajax({
            type: 'POST',
            url: 'create_post/',
            data_type: 'json',
            async: true, // all requests are sent asynchronously
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                the_post: $('#the_post').val(),
            },
            success: function (json) {
                $( "#talk" ).prepend( "<p class='panel'>"+json.message+"</p>" );
                $('.ajaxProgress').hide();
            }
        });

    }


</script>
{% endblock %}